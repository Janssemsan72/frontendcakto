<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Seu download vai iniciar…</title>
    <style>
      body { display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0b0b; color:#fff; }
      .box { text-align:center; background:#121212; border:1px solid #222; border-radius:16px; padding:32px; width:min(520px, 92vw); box-shadow: 0 10px 30px rgba(0,0,0,.35); }
      .btn { display:inline-block; margin-top:16px; background:#c7855e; color:#fff; padding:12px 18px; border-radius:10px; text-decoration:none; font-weight:600; }
      .muted { color:#aaa; font-size:14px; margin-top:8px; }
    </style>
  </head>
  <body>
    <div class="box">
      <h1>Preparando seu download…</h1>
      <p>Se nada acontecer em alguns segundos, clique no botão abaixo.</p>
      <a id="fallback" class="btn" href="#" download>Baixar música</a>
      <p class="muted" id="msg"></p>
    </div>

    <script>
      (function () {
        try {
          const params = new URLSearchParams(location.search);
          const url = params.get('url');
          const name = params.get('filename') || '';
          const fb = document.getElementById('fallback');
          const msg = document.getElementById('msg');

          if (!url) {
            msg.textContent = 'URL do arquivo ausente.';
            return;
          }

          // Configurar botão de fallback
          fb.href = url;
          if (name) fb.setAttribute('download', name);

          // Disparo automático do download
          const a = document.createElement('a');
          a.href = url;
          if (name) a.download = name;
          document.body.appendChild(a);
          a.click();

          // Se o navegador bloquear, o usuário pode clicar no botão
          setTimeout(() => {
            msg.textContent = 'Caso o download não tenha iniciado, use o botão acima.';
          }, 800);
        } catch (e) {
          console.error(e);
          document.getElementById('msg').textContent = 'Não foi possível iniciar o download automaticamente.';
        }
      })();
    </script>
  </body>
</html>
